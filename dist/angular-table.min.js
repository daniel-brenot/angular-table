// author:   Samuel Mueller 
 // version: 1.1.0 
 // license:  MIT 
 // homepage: http://github.com/samu/angular-table

!function(){var n,l,t,u,e,i,s,g,c;angular.module("angular-table",[]),n=class{constructor(t,e){this.attribute=t.attribute,this.title=t.title,this.sortable=t.sortable,this.width=t.width,this.initialSorting=t.initialSorting,e&&(this.customContent=e.customContent,this.attributes=e.attributes)}createElement(){return angular.element(document.createElement("th"))}renderTitle(t){return t.html(this.customContent||this.title)}renderAttributes(t){var e,i,a,r,n;if(this.customContent){for(n=[],i=0,a=(r=this.attributes).length;i<a;i++)e=r[i],n.push(t.attr(e.name,e.value));return n}}renderSorting(t){var e;if(this.sortable)return t.attr("ng-click",`predicate = '${this.attribute}'; descending = !descending;`),(e=angular.element("<i style='margin-left: 10px;'></i>")).attr("ng-class",`getSortIcon('${this.attribute}', predicate, descending)`),t.append(e)}renderWidth(t){return t.attr("width",this.width)}renderHtml(){var t=this.createElement();return this.renderTitle(t),this.renderAttributes(t),this.renderSorting(t),this.renderWidth(t),t}},c=class{constructor(t){this.configObjectName=t,this.itemsPerPage=`${this.configObjectName}.itemsPerPage`,this.sortContext=`${this.configObjectName}.sortContext`,this.fillLastPage=`${this.configObjectName}.fillLastPage`,this.maxPages=`${this.configObjectName}.maxPages`,this.currentPage=`${this.configObjectName}.currentPage`,this.orderBy=`${this.configObjectName}.orderBy`,this.paginatorLabels=`${this.configObjectName}.paginatorLabels`}},u=class{constructor(t,e,i){this.scope=t,this.configurationVariableNames=e,this.listName=i}getList(){return this.scope.$eval(this.listName)}getItemsPerPage(){return this.scope.$eval(this.configurationVariableNames.itemsPerPage)||10}getCurrentPage(){return this.scope.$eval(this.configurationVariableNames.currentPage)||0}getMaxPages(){return this.scope.$eval(this.configurationVariableNames.maxPages)||void 0}getSortContext(){return this.scope.$eval(this.configurationVariableNames.sortContext)||"global"}setCurrentPage(t){return this.scope.$eval(`${this.configurationVariableNames.currentPage}=${t}`)}getOrderBy(){return this.scope.$eval(this.configurationVariableNames.orderBy)||"orderBy"}getPaginatorLabels(){var t={stepBack:"‹",stepAhead:"›",jumpBack:"«",jumpAhead:"»",first:"First",last:"Last"};return this.scope.$eval(this.configurationVariableNames.paginatorLabels)||t}},g=class{constructor(t,e){this.tableElement=t,this.attributes=e,this.id=this.attributes.id,this.config=this.attributes.atConfig,this.paginated=null!=this.attributes.atPaginated,this.list=this.attributes.atList,this.createColumnConfigurations()}capitaliseFirstLetter(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}extractWidth(t){t=/([0-9]+px)/i.exec(t);return t?t[0]:""}isSortable(t){return!!/(sortable)/i.exec(t)}getInitialSorting(t){t=t.attr("at-initial-sorting");if(t){if("asc"===t||"desc"===t)return t;throw`Invalid value for initial-sorting: ${t}. Allowed values are 'asc' or 'desc'.`}}collectHeaderMarkup(t){for(var e,i={},a=t.find("tr").find("th"),r=0,n=a.length;r<n;r++)e=a[r],i[(e=angular.element(e)).attr("at-attribute")]={customContent:e.html(),attributes:e[0].attributes};return i}collectBodyMarkup(t){for(var e,i,a,r,n,s=[],g=t.find("td"),o=0,l=g.length;o<l;o++)a=g[o],e=(a=angular.element(a)).attr("at-attribute"),r=a.attr("at-title")||this.capitaliseFirstLetter(a.attr("at-attribute")),i=void 0!==a.attr("at-sortable")||this.isSortable(a.attr("class")),n=this.extractWidth(a.attr("class")),a=this.getInitialSorting(a),s.push({attribute:e,title:r,sortable:i,width:n,initialSorting:a});return s}createColumnConfigurations(){var t,e,i,a=this.collectHeaderMarkup(this.tableElement),r=this.collectBodyMarkup(this.tableElement);for(this.columnConfigurations=[],e=0,i=r.length;e<i;e++)t=r[e],this.columnConfigurations.push(new n(t,a[t.attribute]))}},e=class{setupTr(t,e){t=t.find("tbody");return t.find("tr").attr("ng-repeat",e),t}},i=class extends e{constructor(t,e){super(),this.list=e,this.repeatString=`item in ${this.list} | orderBy:predicate:descending`}compile(t,e,i){return this.setupTr(t,this.repeatString)}link(){}},t=class extends e{constructor(t){super(),this.configurationVariableNames=t,this.repeatString="item in sortedAndPaginatedList"}compile(t){for(var e=this.setupTr(t,this.repeatString),i=t.find("td"),a="",r=0,n=i.length;r<n;r++)i[r],a+="<td><span>&nbsp;</span></td>";(t=angular.element(document.createElement("tr"))).attr("ng-show",this.configurationVariableNames.fillLastPage),t.html(a),t.attr("ng-repeat","item in fillerArray"),e.append(t)}link(e,t,i,a){var r=this.configurationVariableNames,n=new u(e,r,i.atList),s=function(t,e,i,a,r,n,s,g){return t?(t=i*e-(e=t).length,e="global"===r?(e=g(a)(e,n,s),e=g("limitTo")(e,t),g("limitTo")(e,i)):(e=g("limitTo")(e,t),e=g("limitTo")(e,i),g(a)(e,n,s))):[]},g=function(t,e,i,a){var r,n,s,g,o,l,u,c;if(a=parseInt(a),t.length<=0){for(l=[],c=r=0,s=a-1;0<=s?r<=s:s<=r;c=0<=s?++r:--r)l.push(c);return l}if(e===i-1){if(0==(i=t.length%a))return[];for(u=[],c=n=g=t.length,o=t.length+(a-i-1);g<=o?n<=o:o<=n;c=g<=o?++n:--n)u.push(c);return u}},o=function(){var t;return e.sortedAndPaginatedList=s(n.getList(),n.getCurrentPage(),n.getItemsPerPage(),n.getOrderBy(),n.getSortContext(),e.predicate,e.descending,a),t=Math.ceil(n.getList().length/n.getItemsPerPage()),e.fillerArray=g(n.getList(),n.getCurrentPage(),t,n.getItemsPerPage())};return e.$watch(r.currentPage,o),e.$watch(r.itemsPerPage,o),e.$watch(r.sortContext,o),e.$watchCollection(i.atList,o),e.$watch(`${i.atList}.length`,function(){return e.numberOfPages=Math.ceil(n.getList().length/n.getItemsPerPage()),o()}),e.$watch("predicate",o),e.$watch("descending",o)}},s=class{constructor(t,e,i){this.element=t,this.tableConfiguration=e,this.configurationVariableNames=i}constructHeader(){for(var t,e=angular.element(document.createElement("tr")),i=this.tableConfiguration.columnConfigurations,a=0,r=i.length;a<r;a++)t=i[a],e.append(t.renderHtml());return e}setupHeader(){var t,e=this.element.find("thead");if(e)return t=this.constructHeader(),angular.element(e).find("tr").remove(),e.append(t)}getSetup(){return this.tableConfiguration.paginated?new t(this.configurationVariableNames):new i(this.configurationVariableNames,this.tableConfiguration.list)}compile(){return this.setupHeader(),this.setup=this.getSetup(),this.setup.compile(this.element)}setupInitialSorting(t){for(var e,i=this.tableConfiguration.columnConfigurations,a=[],r=0,n=i.length;r<n;r++)if((e=i[r]).initialSorting){if(!e.attribute)throw"initial-sorting specified without attribute.";t.predicate=e.attribute,a.push(t.descending="desc"===e.initialSorting)}else a.push(void 0);return a}post(a,t,e,i){return this.setupInitialSorting(a),a.getSortIcon||(a.getSortIcon=function(t,e,i){return t!==a.predicate?"glyphicon glyphicon-minus":i?"glyphicon glyphicon-chevron-down":"glyphicon glyphicon-chevron-up"}),this.setup.link(a,t,e,i)}},l=class{constructor(t=0,e=1,i=0,a=1){if(this.lowerBound=t,this.upperBound=e,this.length=a,this.length>this.upperBound-this.lowerBound)throw"sequence is too long";this.data=this.generate(i)}generate(t){var e,i,a,r,n;for(t>this.upperBound-this.length?t=this.upperBound-this.length:t<this.lowerBound&&(t=this.lowerBound),r=[],n=e=i=t,a=parseInt(t)+parseInt(this.length)-1;i<=a?e<=a:a<=e;n=i<=a?++e:--e)r.push(n);return r}resetParameters(t,e,i){if(this.lowerBound=t,this.upperBound=e,this.length=i,this.length>this.upperBound-this.lowerBound)throw"sequence is too long";return this.data=this.generate(this.data[0])}relocate(t){t=this.data[0]+t;return this.data=this.generate(t,t+this.length)}realignGreedy(t){var e;return t<this.data[0]?this.data=this.generate(e=t):t>this.data[this.length-1]?(e=t-(this.length-1),this.data=this.generate(e)):void 0}realignGenerous(t){}},angular.module("angular-table").directive("atTable",["$filter",function(n){return{restrict:"AC",scope:!0,compile:function(t,e,i){var a=new g(t,e),e=new c(e.atConfig),r=new s(t,a,e);return r.compile(),{post:function(t,e,i){return r.post(t,e,i,n)}}}}}]),angular.module("angular-table").directive("atPagination",[function(){return{restrict:"E",scope:!0,replace:!0,template:"<div style='margin: 0px;'> <ul class='pagination'> <li ng-class='{disabled: getCurrentPage() <= 0}'> <a href='' ng-click='stepPage(-numberOfPages)'>{{getPaginatorLabels().first}}</a> </li> <li ng-show='showSectioning()' ng-class='{disabled: getCurrentPage() <= 0}'> <a href='' ng-click='jumpBack()'>{{getPaginatorLabels().jumpBack}}</a> </li> <li ng-class='{disabled: getCurrentPage() <= 0}'> <a href='' ng-click='stepPage(-1)'>{{getPaginatorLabels().stepBack}}</a> </li> <li ng-class='{active: getCurrentPage() == page}' ng-repeat='page in pageSequence.data'> <a href='' ng-click='goToPage(page)' ng-bind='page + 1'></a> </li> <li ng-class='{disabled: getCurrentPage() >= numberOfPages - 1}'> <a href='' ng-click='stepPage(1)'>{{getPaginatorLabels().stepAhead}}</a> </li> <li ng-show='showSectioning()' ng-class='{disabled: getCurrentPage() >= numberOfPages - 1}'> <a href='' ng-click='jumpAhead()'>{{getPaginatorLabels().jumpAhead}}</a> </li> <li ng-class='{disabled: getCurrentPage() >= numberOfPages - 1}'> <a href='' ng-click='stepPage(numberOfPages)'>{{getPaginatorLabels().last}}</a> </li> </ul> </div>",link:function(a,t,e){var i=new c(e.atConfig),r=new u(a,i,e.atList),n=function(t,e,i){return t=Math.max(e,t),Math.min(i,t)},s=function(){return a.numberOfPages},g=function(t){return a.numberOfPages=t},o=function(t){var e,i;if(r.getList())return 0<r.getList().length?(e=Math.ceil(r.getList().length/r.getItemsPerPage()),g(e),i=a.showSectioning()?r.getMaxPages():e,a.pageSequence.resetParameters(0,e,i),r.setCurrentPage(n(r.getCurrentPage(),0,s()-1)),a.pageSequence.realignGreedy(r.getCurrentPage())):(g(1),a.pageSequence.resetParameters(0,1,1),r.setCurrentPage(0),a.pageSequence.realignGreedy(0))};return a.showSectioning=function(){return r.getMaxPages()&&s()>r.getMaxPages()},a.getCurrentPage=function(){return r.getCurrentPage()},a.getPaginatorLabels=function(){return r.getPaginatorLabels()},a.stepPage=function(t){return t=parseInt(t),r.setCurrentPage(n(r.getCurrentPage()+t,0,s()-1)),a.pageSequence.realignGreedy(r.getCurrentPage())},a.goToPage=function(t){return r.setCurrentPage(t)},a.jumpBack=function(){return a.stepPage(-r.getMaxPages())},a.jumpAhead=function(){return a.stepPage(r.getMaxPages())},a.pageSequence=new l,a.$watch(i.itemsPerPage,function(){return o()}),a.$watch(i.maxPages,function(){return o()}),a.$watch(e.atList,function(){return o()}),a.$watch(`${e.atList}.length`,function(){return o()}),o()}}}]),angular.module("angular-table").directive("atImplicit",[function(){return{restrict:"AC",compile:function(t,e,i){var a=t.attr("at-attribute");if(!a)throw`at-implicit specified without at-attribute: ${t.html()}`;return t.append(`<span ng-bind='item.${a}'></span>`)}}}])}.call(this);